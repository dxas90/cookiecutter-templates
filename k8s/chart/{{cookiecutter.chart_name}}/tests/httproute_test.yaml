suite: test httproute
templates:
  - httproute.yaml
tests:
  - it: should create HTTPRoute when enabled
    set:
      httproute.enabled: true
    asserts:
      - isKind:
          of: HTTPRoute
      - equal:
          path: metadata.name
          value: RELEASE-NAME-{{ cookiecutter.chart_name }}
      - equal:
          path: metadata.labels["app.kubernetes.io/part-of"]
          value: {{ cookiecutter.chart_label }}

  - it: should not create HTTPRoute when disabled
    set:
      httproute.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should configure hostnames
    set:
      httproute.enabled: true
    asserts:
      - contains:
          path: spec.parentRefs
          content:
            name: {{ cookiecutter.httproute_gateway_name }}
            namespace: {{ cookiecutter.httproute_gateway_namespace }}
            sectionName: {{ cookiecutter.httproute_gateway_sectionname }}

  - it: should configure hostnames
    set:
      httproute.enabled: true
    asserts:
      - contains:
          path: spec.hostnames
          content: {{ cookiecutter.httproute_hostname }}

  - it: should configure backend service
    set:
      httproute.enabled: true
    asserts:
      - equal:
          path: spec.rules[0].backendRefs[0].port
          value: {{ cookiecutter.service_port }}
